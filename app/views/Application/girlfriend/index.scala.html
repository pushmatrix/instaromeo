@(title:String)

@main(title) {
  	<img src="@asset("public/images/female.png")"/>
  	<img id="prog-ico-anniversary" class="inactive" src="@asset("public/images/anniversary.png")"/>
  	<img id="prog-ico-birthday" class="inactive" src="@asset("public/images/birthday.png")"/>
  	<img id="prog-ico-surprise" class="inactive" src="@asset("public/images/surprise.png")">
  	<img id="prog-ico-calendar" class="inactive" src="@asset("public/images/calendar.png")"/>
  	<img id="prog-ico-checkout" class="inactive" src="@asset("public/images/checkout.png")"/>
  
} {
    <div id="slider1">
      <div class="wiz-slide">@views.Application.girlfriend.html.name()</div>
      <div class="wiz-slide"> @views.Application.girlfriend.html.aniversary()</div>
      <div class="wiz-slide"> @views.Application.girlfriend.html.birthday()</div>
      <div class="wiz-slide"> @views.Application.girlfriend.html.random()</div>
	    <div class="wiz-slide"> @views.Application.girlfriend.html.order()</div>
	    <div class="wiz-slide"> @views.Application.girlfriend.html.address()</div>
	    <div class="wiz-slide"> @views.Application.girlfriend.html.checkout()</div>
	    <div class="wiz-slide"> @views.Application.girlfriend.html.congrats()</div>
    </div>
    
    <script>
    $(function(){
      deliveryTemplate = $("#deliveries .delivery")[0].outerHTML;
      dateFormat = 'yyyy-MM-dd';
      
      instaromeo_order = {
          gfName: "",
          deliveries: [],
          addDelivery: function(delivery) {
            var id = 'delivery_' + instaromeo_order.deliveries.length;
            instaromeo_order.deliveries.push(delivery);
            
            var deliveryHTML = $(deliveryTemplate);
            deliveryHTML.find(".icon img").attr("src", "/public/images/" + delivery.type + ".png");
            deliveryHTML.find(".date-text").text(delivery.date.toString(dateFormat));
            deliveryHTML.attr('id', id);
            $("#deliveries").append(deliveryHTML[0].outerHTML);
            
            // update the deliveryHTML with the actual node in the dom.
            deliveryHTML = $("#" + id);
            deliveryHTML.fadeIn();
            if (delivery.type == "surprise" || delivery.type == "birthday" || delivery.type == "anniversary") {
              var datepicker = $("#" + id + " .datepicker");
              datepicker.show();
              // the date picker has to be initialized after the node is in the dom
              initDatePicker(datepicker, function(target, newDate)
              {
                target.parent().find(".date-text").text(newDate.toString(dateFormat));
              });
            }
    
          },
          removeDelivery: function(id) {
            instaromeo_order.deliveries[id] = null;
            $("#delivery_" + id).fadeOut();
          },
          addDeliveryFromDatePicker: function(delivery_type, datepicker_id){
               var delivery = {
                   type: delivery_type,
                   date: Date.parse($("#" + datepicker_id).val())
               };

               this.addDelivery(delivery);      
          },
          addRandomDelivery: function(){
              var date = Date.parse(Math.ceil(Math.random()*12) + "/" + Math.ceil(Math.random()*29));
              if(date.compareTo(Date.parse("Today")) < 0){
                  date.addYears(1);
              }
              var delivery = {
                  type: "everyday",
                  date: date 
              };
              this.addDelivery(delivery); 
          }
      };
      
      
      $('#add-delivery').click(function(){
        var delivery = {
          type: 'surprise',
          date: new Date()
        };
        instaromeo_order.addDelivery(delivery);
      });
      
      slider = $('#slider1').bxSlider({
        mode: 'fade',
        controls: false
      });
      
       $('.next').click(function(){
            slider.goToNextSlide();
            $(".inactive").first().removeClass("inactive");
            return false;
        });
        
        $("#annivNext").click(function(){
            instaromeo_order.addDeliveryFromDatePicker("anniversary", "anniversary");
        });
        
       // slider.goToSlide(6);
        $("#birthdayNext").click(function(){
            instaromeo_order.addDeliveryFromDatePicker("birthday", "birthday");
        });
        
        $("#randomNextYes").click(function(){
                instaromeo_order.addRandomDelivery();
        });
        
        $(".div-checkbox").click(function(){
            toggleCheck("chk-random");
        });
        
        $("#purchase").click(function() {
        //  $(this).hide();
          $("#purchaseLoading").show();
          var data = $("#senderInfo, #recipientInfo").serialize();
          data += "&deliveries=" + JSON.stringify(instaromeo_order.deliveries);
          $.post("/orders", data).success(function(){
          //  slider.goToNextSlide();
          });
        });
        
        function initDatePicker(element, onChange) {
          element.glDatePicker(
             {
                cssName: "android",
                startDate: new Date(Date.parse("Today")),
                endDate: new Date(Date.parse("Yesterday").addYears(1)),
                allowOld: false,
                position: "fixed",
                onChange: onChange
              });
        }
        
        $("#modifyOrder").click(function() {
          slider.goToSlide(4);
        });
        $("#modifyAddress").click(function() {
          slider.goToSlide(5);
        });
        $(".datepicker").each(function(){
          initDatePicker($(this), function(target, newDate)
          {
            target.val(newDate.toString(dateFormat));
          });
        });
        
        // initialize common dates
        instaromeo_order.addDelivery({
            type: "valentines", 
            date: Date.parse("February 14 2012")
        });

          $(".remove").live('click',function(ev){
            ev.preventDefault();
            instaromeo_order.removeDelivery($(this).parent().attr("id").split("_")[1]);
          });
          
          $(".datepicker").live('keyup',function(){
              if (Date.parse($(this).val()) !== null)
              {
                var newDate = Date.parse($(this).val());
                if(newDate.compareTo(Date.parse("Today")) < 0){
                      newDate.addYears(1);
                }
                $(this).glDatePicker("setSelectedDate", newDate);
                $(this).glDatePicker("gotoSelectedDate"); 
              }
    
          });

          var typewatch = (function(){
                var timer = 0;
                return function(callback, ms){
                    clearTimeout (timer);
                    timer = setTimeout(callback, ms);
                }  
                })();
        
    });
    </script>
    
}